"use strict";(self.webpackChunkdhenara_docs=self.webpackChunkdhenara_docs||[]).push([[982],{8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var i=t(6540);const a={},o=i.createContext(a);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},8563:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"dhenara-agent/guides/tutorials/command-line-coder/enhanced-implementation","title":"Part 3: Enhanced Implementation Flow","description":"In the previous parts, we built a single-shot implementation flow and a planning flow. Now we\'ll enhance our","source":"@site/docs/dhenara-agent/guides/tutorials/command-line-coder/enhanced-implementation.md","sourceDirName":"dhenara-agent/guides/tutorials/command-line-coder","slug":"/dhenara-agent/guides/tutorials/command-line-coder/enhanced-implementation","permalink":"/dhenara-agent/guides/tutorials/command-line-coder/enhanced-implementation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"dhenaraAgentSidebar","previous":{"title":"Part 2: Planning Flow","permalink":"/dhenara-agent/guides/tutorials/command-line-coder/planning"},"next":{"title":"Part 4: Coordinator Flow","permalink":"/dhenara-agent/guides/tutorials/command-line-coder/coordination"}}');var a=t(4848),o=t(8453);const r={sidebar_position:4},l="Part 3: Enhanced Implementation Flow",s={},d=[{value:"Creating the Enhanced Implementation Flow",id:"creating-the-enhanced-implementation-flow",level:2},{value:"Updating the Handler",id:"updating-the-handler",level:2},{value:"Testing the Enhanced Implementation Flow",id:"testing-the-enhanced-implementation-flow",level:2},{value:"Key Improvements in the Enhanced Implementation Flow",id:"key-improvements-in-the-enhanced-implementation-flow",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"part-3-enhanced-implementation-flow",children:"Part 3: Enhanced Implementation Flow"})}),"\n",(0,a.jsx)(n.p,{children:"In the previous parts, we built a single-shot implementation flow and a planning flow. Now we'll enhance our\nimplementation flow to work with the tasks generated by the planner."}),"\n",(0,a.jsx)(n.p,{children:"This enhanced implementation flow will:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Accept a task specification from the planner"}),"\n",(0,a.jsx)(n.li,{children:"Dynamically analyze the required context for that specific task"}),"\n",(0,a.jsx)(n.li,{children:"Generate and execute precise file operations"}),"\n",(0,a.jsx)(n.li,{children:"Provide better error handling and validation"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"creating-the-enhanced-implementation-flow",children:"Creating the Enhanced Implementation Flow"}),"\n",(0,a.jsx)(n.p,{children:"Let's create an enhanced implementation flow that can work with tasks from the planner:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# src/agents/planner_coder/flows/implementation.py\nfrom dhenara.agent.dsl import (\n    PLACEHOLDER,\n    AIModelNode,\n    AIModelNodeSettings,\n    EventType,\n    FileOperationNode,\n    FileOperationNodeSettings,\n    FlowDefinition,\n    FolderAnalyzerNode,\n    FolderAnalyzerSettings,\n)\nfrom dhenara.ai.types import (\n    AIModelCallConfig,\n    ObjectTemplate,\n    Prompt,\n)\n\nfrom ..types import TaskImplementation\n\n# Constants\nglobal_data_directory = "$expr{run_root}/global_data"\nmodels = [\n    "claude-3-7-sonnet",\n    "gpt-4.1",\n    "gpt-4.1-mini",\n]\ntest_mode = False\n\n# Create the implementation flow\nimplementation_flow = FlowDefinition().vars(\n    {\n        "task_spec": PLACEHOLDER,  # This will be filled by the coordinator\n    }\n)\n\n# 1. Dynamic Folder Analysis based on task requirements\nimplementation_flow.node(\n    "dynamic_context_analysis",\n    FolderAnalyzerNode(\n        settings=FolderAnalyzerSettings(\n            base_directory=global_data_directory,\n            operations_template=ObjectTemplate(expression="$expr{task_spec.required_context}"),\n        ),\n    ),\n)\n\n# 2. Code Generation Node\nimplementation_flow.node(\n    "code_generator",\n    AIModelNode(\n        pre_events=[EventType.node_input_required],\n        settings=AIModelNodeSettings(\n            models=models,\n            system_instructions=[\n                "You are a professional code implementation agent specialized in executing precise file operations.",\n                "Your task is to generate the exact file operations necessary to implement requested code changes - nothing more, nothing less.",\n                "Generate machine-executable operations that require zero human intervention.",\n                "ALLOWED OPERATIONS:",\n                "- create_file(file_path, content)",\n                "- delete_file(file_path)",\n                "- create_directory(directory_path)",\n                "- move_file(source_path, destination_path)",\n                "IMPLEMENTATION GUIDELINES:",\n                "1. For complete file replacement, use delete_file followed by create_file.",\n                "2. Maintain the project\'s existing code style, indentation, and formatting conventions.",\n                "3. Use Python 3.10 style in all code examples.",\n                "4. Focus on implementing ONLY the specific task assigned to you, not the entire project.",\n                "5. Reference the analyzed context to understand the existing code structure.",\n            ],\n            prompt=Prompt.with_dad_text(\n                text=(\n                    "## Task Specification\\n"\n                    "Task ID: $expr{task_spec.task_id}\\n"\n                    "Order: $expr{task_spec.order}\\n"\n                    "Description: $expr{task_spec.description}\\n\\n"\n                    "## Repository Context\\n"\n                    "$expr{$hier{dynamic_context_analysis}.outcome.results}\\n\\n"\n                    "## Implementation Requirements\\n"\n                    "1. Generate precise file operations that can be executed programmatically\\n"\n                    "2. Focus only on implementing THIS specific task, not the entire project\\n"\n                    "3. Consider the relevant context when making implementation decisions\\n"\n                    "4. Follow a complete implementation strategy that addresses all aspects of this specific task\\n\\n"\n                    "## Output Format\\n"\n                    "Return a TaskImplementation object with the task_id set to: $expr{task_spec.task_id}\\n"\n                ),\n            ),\n            model_call_config=AIModelCallConfig(\n                structured_output=TaskImplementation,\n                test_mode=test_mode,\n                max_output_tokens=16000,  # Increased token limit for complex implementations\n                reasoning=True,  # Enable reasoning for better transparency\n            ),\n        ),\n    ),\n)\n\n# 3. File Operation Node\nimplementation_flow.node(\n    "file_operations",\n    FileOperationNode(\n        settings=FileOperationNodeSettings(\n            base_directory=global_data_directory,\n            operations_template=ObjectTemplate(\n                expression="$expr{ $hier{code_generator}.outcome.structured.file_operations }",\n            ),\n            stage=True,  # Stage changes without committing\n            commit=False,  # Commit handled in the coordinator\n            commit_message="Implemented task: $expr{task_spec.task_id}",\n        ),\n    ),\n)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"updating-the-handler",children:"Updating the Handler"}),"\n",(0,a.jsx)(n.p,{children:"Now we need to update our handler to support the enhanced implementation flow:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# src/agents/planner_coder/handler.py\n# (Add to existing handler.py file)\n\nasync def planner_coder_input_handler(event: NodeInputRequiredEvent):\n    """Handles input required events for the planner coder"""\n    if event.node_type == FlowNodeTypeEnum.ai_model_call:\n        node_input = None\n\n        if event.node_id == "plan_generator":\n            # ... existing plan_generator handler code ...\n\n        elif event.node_id == "code_generator":\n            node_input = await get_ai_model_node_input(\n                node_def_settings=event.node_def_settings,\n                models=models,\n            )\n            # No additional prompt variables needed here\n            # The task_spec is already passed to the flow as a variable\n\n        else:\n            print(f"WARNING: Unhandled ai_model_call input event for node {event.node_id}")\n\n        event.input = node_input\n        event.handled = True\n\n    elif event.node_type == FlowNodeTypeEnum.folder_analyzer:\n        # ... existing folder_analyzer handler code ...\n'})}),"\n",(0,a.jsx)(n.h2,{id:"testing-the-enhanced-implementation-flow",children:"Testing the Enhanced Implementation Flow"}),"\n",(0,a.jsx)(n.p,{children:"To test just the implementation flow (without the coordinator), we can create a simple test agent that uses a predefined\ntask specification:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# src/agents/planner_coder/test_implementation.py\nfrom dhenara.agent.dsl import AgentDefinition, FlowDefinition\nfrom dhenara.agent.dsl.inbuilt.flow_nodes.defs.types import FolderAnalysisOperation\n\nfrom .flows.implementation import implementation_flow\nfrom .types import TaskSpec\n\n# Create a test task specification\ntest_task = TaskSpec(\n    order=1,\n    task_id="create_flask_app",\n    description="Create a basic Flask application with a main.py file that sets up a simple web server with a \'Hello, World!\' route at \'/\'.",\n    required_context=[\n        FolderAnalysisOperation(\n            operation_type="analyze_folder",\n            path=".",\n            max_depth=2,\n            content_read_mode="structure",\n        ),\n    ],\n)\n\n# Create a test flow that uses our implementation flow with the test task\ntest_flow = FlowDefinition()\ntest_flow.subflow(\n    "implementation",\n    implementation_flow,\n    variables={\n        "task_spec": test_task,\n    },\n)\n\n# Create a test agent\ntest_agent = AgentDefinition()\ntest_agent.flow(\n    "test_implementation",\n    test_flow,\n)\n'})}),"\n",(0,a.jsx)(n.p,{children:"You can then create a runner for this test agent and run it to see how the implementation flow works with a specific\ntask."}),"\n",(0,a.jsx)(n.h2,{id:"key-improvements-in-the-enhanced-implementation-flow",children:"Key Improvements in the Enhanced Implementation Flow"}),"\n",(0,a.jsx)(n.p,{children:"Let's highlight the key improvements in our enhanced implementation flow compared to the single-shot implementation:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Task-specific context"}),": The flow now analyzes only the specific files needed for the current task, rather than the\nentire codebase"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Focus on specific requirements"}),": The prompt emphasizes implementing only the current task, not the entire project"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Better error handling"}),": With reasoning enabled, we get more transparency into the implementation process"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Increased token limit"}),": We've increased the max_output_tokens to handle more complex implementations"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Dynamic operation"}),": The flow can work with any task specification provided by the planner"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,a.jsx)(n.p,{children:"Now that we have both a planning flow and an enhanced implementation flow, we need to create a coordinator flow that\ncan:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Run the planner to generate tasks"}),"\n",(0,a.jsx)(n.li,{children:"Iterate through each task in the plan"}),"\n",(0,a.jsx)(n.li,{children:"Run the implementation flow for each task"}),"\n",(0,a.jsx)(n.li,{children:"Handle errors and track progress"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["In ",(0,a.jsx)(n.a,{href:"/dhenara-agent/guides/tutorials/command-line-coder/coordination",children:"Part 4: Coordinator Flow"}),", we'll bring everything together to create our complete command-line\ncoding assistant."]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);